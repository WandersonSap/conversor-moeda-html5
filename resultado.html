<html>
	<head>
		<title>Conversor de Moeda</title>
		<meta charset="utf-8" />
		<link href="style.css" rel="stylesheet" />
		<script>
			
			var url;
			
			function voltar(){
				var resposta = confirm("Deseja voltar?");
				if(resposta){
					location.href = "index.html";
				}
			}
			
			window.onload = function(){
				url = new URL(location.href);
				chamarAPI();
			}
			
	
			function chamarAPI(){
				var dCotacao = url.searchParams.get("data_cotação")
				const domain = "https://api.exchangeratesapi.io/";
				var endpoint = domain + (dCotacao?  dCotacao : "latest");
				var path = endpoint + "?base=" + url.searchParams.get("moeda_base");
				var request = new XMLHttpRequest();
				
				request.addEventListener("load", respostaAPI);
				request.open("GET", path);
				request.send();
			}
			
			function respostaAPI(){
				var oResposta = JSON.parse(this.responseText);
				
				var sMoedaBase = url.searchParams.get("moeda_base");
				var sMoedaDestino = url.searchParams.get("moeda_destino");
				var fValorDestino = parseFloat(oResposta.rates[sMoedaDestino]).toFixed(2);
				var dCotacao = oResposta.date;
				
				document.querySelector("#moeda_base").innerText = sMoedaBase;
				document.querySelector("#valor_destino").innerText = fValorDestino;
				document.querySelector("#moeda_destino").innerText = sMoedaDestino;
				document.querySelector("#data_cotacao").innerText = dCotacao;
				
				var aMoedaDestino = url.searchParams.getAll("moeda_destino");
				
				aMoedaDestino.forEach(function(sMoedaDestino){
					
					if ('content' in document.createElement('template')) {
						
					    var t = document.querySelector('#linha');
					    var tb = document.querySelector("tbody");
					    var clone = document.importNode(t.content, true);
					    td = clone.querySelectorAll("td");
						var fValorDestino = parseFloat(oResposta.rates[sMoedaDestino]).toFixed(2);;
					    td[0].textContent = fValorDestino;
					    td[1].textContent = sMoedaDestino;
					    
					    tb.appendChild(clone);
				
					}

				});
	
			}
		</script>
	</head>
	<body>
		<p>1 
			<span id="moeda_base">EUR</span> 
			equivaleu a
			<span id="valor_destino"></span> <span id="moeda_destino"></span>
			no dia 
			<span id="data_cotacao"></span>
		</p>
		
		<table id="tabela">
		  <thead>
		    <tr>
		      <td>Valor</td>
		      <td>Moeda</td>
		    </tr>
		  </thead>
		  <tbody>
		    <!-- existing data could optionally be included here -->
		  </tbody>
		  <tbody>
		   
		  </tbody>
		</table>

		<template id="linha">
		  <tr>
		    <td class="record"></td>
		    <td></td>
		  </tr>
		</template> 
		
		<button type="button" onclick="voltar()">
		    Voltar
		</button>
	</body>
</html>